<html>
<head>
<title>Eager Feet ~ Export Data from Nike+</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js" type="text/javascript"></script>
<style>
#progress {
	display: none;
}
</style>
<script type="text/javascript">
// from http://dansnetwork.com/javascript-iso8601rfc3339-date-parser/
Date.prototype.setISO8601 = function(dString){

	var regexp = /(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;

	if (dString.toString().match(new RegExp(regexp))) {
		var d = dString.match(new RegExp(regexp));
		var offset = 0;
		
		this.setUTCDate(1);
		this.setUTCFullYear(parseInt(d[1],10));
		this.setUTCMonth(parseInt(d[3],10) - 1);
		this.setUTCDate(parseInt(d[5],10));
		this.setUTCHours(parseInt(d[7],10));
		this.setUTCMinutes(parseInt(d[9],10));
		this.setUTCSeconds(parseInt(d[11],10));
		if (d[12])
			this.setUTCMilliseconds(parseFloat(d[12]) * 1000);
		else
			this.setUTCMilliseconds(0);
			if (d[13] != 'Z') {
				offset = (d[15] * 60) + parseInt(d[17],10);
				offset *= ((d[14] == '-') ? -1 : 1);
				this.setTime(this.getTime() - offset * 60 * 1000);
			}
		} else {
			this.setTime(Date.parse(dString));
	}
	return this;
};

function lookup() {
	$('#progress').show();
	$('#submit').hide();
	$.get('http://eagerfeet.org/api/runs/'+$('#userID')[0].value, function(data) {
		$('#progress').hide();
		$('#submit').show();
		if (data.code == 0) {
			var runs = $('#runs')[0];
			runs.innerHTML = "";
			var date = new Date();
			data.runs.forEach(function(run) {
				runs.innerHTML += "<p>"+date.setISO8601(run.startTime)+", "+parseFloat(run.distance).toFixed(2)+" mi</p>";
			});
		} else {
			$('#runs')[0].innerHTML = "<p>Error: "+data.message+"</p>";
		}
	})
	.error(function() {
		$('#runs')[0].innerHTML = "<p>Error: Server is down, please try again later.</p>";
		$('#progress').hide();
		$('#submit').show();
	});
}
</script>
</head>
<body>
<form>
<input type="text" name="userID" id="userID" value="" />
<input type="button" onclick="lookup()" id="submit" value="Submit" />
<div id="progress"><img src="progress-spinner.gif" width="32" height="32"></div>
</form>
<div id="runs"></div>
</body>
</html>